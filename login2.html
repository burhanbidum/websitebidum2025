<!doctype html>
<html lang="id">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Data Siswa SMA IT Putri Mataram</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        
        .floating-header {
            backdrop-filter: blur(10px);
            background: rgba(59, 130, 246, 0.95);
        }
        
        .login-bg {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 50%, #60a5fa 100%);
        }
        
        .table-header {
            background: linear-gradient(90deg, #1e40af, #3b82f6);
        }
        
        .popup-overlay {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }
        
        .popup-content {
            animation: popupSlide 0.3s ease-out;
        }
        
        @keyframes popupSlide {
            from {
                opacity: 0;
                transform: scale(0.8) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        .tab-active {
            background: linear-gradient(90deg, #1e40af, #3b82f6);
            color: white;
        }
        
        .progress-bar {
            background: linear-gradient(90deg, #3b82f6, #60a5fa);
        }
        
        .thumbnail {
            transition: transform 0.2s ease;
        }
        
        .thumbnail:hover {
            transform: scale(1.1);
        }
        
        .delete-btn:hover {
            transform: scale(1.1);
        }
        
        .search-input {
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="bg-gray-50 min-h-full"><!-- Login Page -->
  <div id="loginPage" class="min-h-full flex">
   <div class="flex-1 login-bg flex items-center justify-center p-8">
    <div class="text-white text-center max-w-md">
     <h1 id="loginTitle" class="text-4xl font-bold mb-4">Login Administrator</h1>
     <p class="text-xl opacity-90">Sistem Manajemen Data Siswa</p>
     <div class="mt-8 p-6 bg-white bg-opacity-10 rounded-2xl backdrop-blur-sm">
      <h2 class="text-2xl font-semibold mb-2">SMA IT PUTRI MATARAM</h2>
      <p class="opacity-80">Selamat datang di portal data siswa</p>
     </div>
    </div>
   </div>
   <div class="flex-1 bg-white flex items-center justify-center p-8">
    <div class="max-w-md w-full">
     <div class="bg-white p-8 rounded-3xl shadow-2xl border border-gray-100">
      <h2 class="text-3xl font-bold text-gray-800 mb-8 text-center">Masuk</h2>
      <form id="loginForm" class="space-y-6">
       <div><label class="block text-sm font-medium text-gray-700 mb-2">Username</label> <input type="text" id="username" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Masukkan username">
       </div>
       <div><label class="block text-sm font-medium text-gray-700 mb-2">Password</label> <input type="password" id="password" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Masukkan password">
       </div>
       <div id="loginError" class="text-red-500 text-sm hidden">
        Username atau password salah!
       </div><button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-blue-700 text-white py-3 px-4 rounded-xl hover:from-blue-700 hover:to-blue-800 transition duration-200 font-semibold"> Masuk </button>
      </form>
     </div>
    </div>
   </div>
  </div><!-- Main Application -->
  <div id="mainApp" class="hidden min-h-full"><!-- Floating Header -->
   <header class="floating-header fixed top-4 left-4 right-4 z-50 rounded-2xl shadow-lg">
    <div class="px-6 py-4">
     <div class="flex items-center justify-between">
      <h1 id="siteTitle" class="text-2xl font-bold text-white">DATA SISWA SMA IT PUTRI MATARAM</h1><button id="logoutBtn" class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-4 py-2 rounded-lg transition duration-200"> Keluar </button>
     </div>
    </div>
   </header><!-- Tab Navigation -->
   <div class="pt-24 px-4">
    <div class="max-w-7xl mx-auto">
     <div class="flex space-x-1 bg-gray-200 p-1 rounded-xl mb-6"><button class="tab-btn tab-active flex-1 py-3 px-4 rounded-lg font-medium transition duration-200" data-tab="data"> üìä Data Siswa </button> <button class="tab-btn flex-1 py-3 px-4 rounded-lg font-medium transition duration-200 hover:bg-gray-300" data-tab="infografis"> üìà Infografis </button> <button class="tab-btn flex-1 py-3 px-4 rounded-lg font-medium transition duration-200 hover:bg-gray-300" data-tab="tambah"> ‚ûï Tambah Siswa </button>
     </div><!-- Data Tab -->
     <div id="dataTab" class="tab-content"><!-- Controls -->
      <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
       <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-4">
        <div><label class="block text-sm font-medium text-gray-700 mb-2">Filter Kelas</label> <select id="kelasFilter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"> <option value="">Semua Kelas</option> </select>
        </div>
        <div><label class="block text-sm font-medium text-gray-700 mb-2">Pencarian Cepat</label> <input type="text" id="searchInput" class="search-input w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Cari nama atau NISN...">
        </div>
        <div><label class="block text-sm font-medium text-gray-700 mb-2">Tampilkan</label> <select id="entriesSelect" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"> <option value="10">10 data</option> <option value="20">20 data</option> <option value="50">50 data</option> <option value="100">100 data</option> <option value="all">Semua data</option> </select>
        </div>
        <div class="flex items-end"><button id="resetBtn" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition duration-200"> üîÑ Reset </button>
        </div>
       </div>
      </div><!-- Data Table -->
      <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
       <div class="overflow-x-auto">
        <table class="w-full">
         <thead class="table-header text-white">
          <tr>
           <th class="px-4 py-4 text-left font-semibold">NISN</th>
           <th class="px-4 py-4 text-left font-semibold">Nama Lengkap</th>
           <th class="px-4 py-4 text-left font-semibold">Tempat Lahir</th>
           <th class="px-4 py-4 text-left font-semibold">Tanggal Lahir</th>
           <th class="px-4 py-4 text-left font-semibold">Jenis Kelamin</th>
           <th class="px-4 py-4 text-left font-semibold">Kelas</th>
           <th class="px-4 py-4 text-left font-semibold">No HP Siswa</th>
           <th class="px-4 py-4 text-left font-semibold">No HP Ortu</th>
           <th class="px-4 py-4 text-left font-semibold">Foto</th>
           <th class="px-4 py-4 text-left font-semibold">Aksi</th>
          </tr>
         </thead>
         <tbody id="dataTableBody">
          <tr>
           <td colspan="10" class="px-4 py-8 text-center text-gray-500">
            <div class="flex items-center justify-center">
             <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mr-3"></div> Memuat data...
            </div></td>
          </tr>
         </tbody>
        </table>
       </div><!-- Pagination -->
       <div class="bg-gray-50 px-6 py-4 border-t">
        <div class="flex items-center justify-between">
         <div class="text-sm text-gray-700">
          Menampilkan <span id="showingStart">0</span> - <span id="showingEnd">0</span> dari <span id="totalEntries">0</span> data
         </div>
         <div class="flex space-x-2" id="pagination"><!-- Pagination buttons will be inserted here -->
         </div>
        </div>
       </div>
      </div>
     </div><!-- Infografis Tab -->
     <div id="infografisTab" class="tab-content hidden">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6"><!-- Stats Cards -->
       <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-2xl p-6 text-white">
        <h3 class="text-lg font-semibold mb-2">Total Siswa</h3>
        <p id="totalSiswa" class="text-3xl font-bold">0</p>
       </div>
       <div class="bg-gradient-to-r from-green-500 to-green-600 rounded-2xl p-6 text-white">
        <h3 class="text-lg font-semibold mb-2">Laki-laki</h3>
        <p id="totalLaki" class="text-3xl font-bold">0</p>
       </div>
       <div class="bg-gradient-to-r from-pink-500 to-pink-600 rounded-2xl p-6 text-white">
        <h3 class="text-lg font-semibold mb-2">Perempuan</h3>
        <p id="totalPerempuan" class="text-3xl font-bold">0</p>
       </div>
      </div><!-- Filter for Infografis -->
      <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
       <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div><label class="block text-sm font-medium text-gray-700 mb-2">Filter Kelas</label> <select id="infografisKelasFilter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"> <option value="">Semua Kelas</option> </select>
        </div>
       </div>
      </div><!-- Class Distribution -->
      <div class="bg-white rounded-2xl shadow-lg p-6">
       <h3 class="text-xl font-bold text-gray-800 mb-6">Distribusi Siswa per Kelas</h3>
       <div id="classDistribution"><!-- Class bars will be inserted here -->
       </div>
      </div>
     </div><!-- Tambah Siswa Tab -->
     <div id="tambahTab" class="tab-content hidden">
      <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
       <div class="p-6 border-b">
        <h3 class="text-xl font-bold text-gray-800">Tambah Data Siswa Baru</h3>
        <p class="text-gray-600 mt-2">Gunakan formulir di bawah ini untuk menambahkan data siswa baru</p>
       </div>
       <div class="p-6"><iframe src="https://tally.so/embed/MeKkRp?alignLeft=1&amp;hideTitle=1&amp;transparentBackground=1&amp;dynamicHeight=1" width="100%" height="800" frameborder="0" marginheight="0" marginwidth="0" title="Form Tambah Siswa" class="rounded-lg"> </iframe>
       </div>
      </div>
     </div>
    </div>
   </div><!-- Footer -->
   <footer class="bg-gradient-to-r from-blue-800 to-blue-900 text-white mt-12">
    <div class="max-w-7xl mx-auto px-4 py-8">
     <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
      <div>
       <h4 class="text-lg font-semibold mb-4">SMA IT PUTRI MATARAM</h4>
       <p class="text-blue-200">Sistem Manajemen Data Siswa yang terintegrasi untuk kemudahan administrasi sekolah.</p>
      </div>
      <div>
       <h4 class="text-lg font-semibold mb-4">Fitur Utama</h4>
       <ul class="text-blue-200 space-y-2">
        <li>‚Ä¢ Manajemen Data Siswa</li>
        <li>‚Ä¢ Laporan Infografis</li>
        <li>‚Ä¢ Pencarian &amp; Filter</li>
        <li>‚Ä¢ Export Data</li>
       </ul>
      </div>
      <div>
       <h4 class="text-lg font-semibold mb-4">Kontak</h4>
       <div class="text-blue-200 space-y-2">
        <p>üìß admin@smaitputri.sch.id</p>
        <p>üìû (0370) 123-4567</p>
        <p>üìç Mataram, NTB</p>
       </div>
      </div>
     </div>
     <div class="border-t border-blue-700 mt-8 pt-6 text-center">
      <p id="footerText" class="text-blue-200">¬© 2025 SMA IT PUTRI MATARAM. Semua hak dilindungi.</p>
     </div>
    </div>
   </footer>
  </div><!-- Photo Popup -->
  <div id="photoPopup" class="popup-overlay fixed inset-0 z-50 hidden flex items-center justify-center p-4">
   <div class="popup-content bg-white rounded-2xl shadow-2xl max-w-md w-full">
    <div class="p-4 border-b flex justify-between items-center">
     <h3 class="text-lg font-semibold">Foto Siswa</h3><button id="closePopup" class="text-gray-500 hover:text-gray-700 text-2xl">√ó</button>
    </div>
    <div class="p-6 text-center"><img id="popupImage" src="" alt="Foto Siswa" class="max-w-full h-auto rounded-lg shadow-lg">
     <p id="popupName" class="mt-4 text-lg font-semibold text-gray-800"></p>
    </div>
   </div>
  </div>
  <script>
        // Configuration
        const defaultConfig = {
            site_title: "DATA SISWA SMA IT PUTRI MATARAM",
            login_title: "Login Administrator",
            footer_text: "¬© 2025 SMA IT PUTRI MATARAM. Semua hak dilindungi."
        };

        // Global variables
        let studentsData = [];
        let filteredData = [];
        let currentPage = 1;
        let entriesPerPage = 10;
        let currentTab = 'data';

        // CSV URL
        const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRhgCr-PknfGQ1OSvwY_QfoArz4p9UfzQmc4dVAv08IHB4uQSiy6QBx3ul6XEmvL2M2fhjL0HnS2Bze/pub?gid=0&single=true&output=csv';

        // Initialize Element SDK
        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig: defaultConfig,
                onConfigChange: async (config) => {
                    document.getElementById('siteTitle').textContent = config.site_title || defaultConfig.site_title;
                    document.getElementById('loginTitle').textContent = config.login_title || defaultConfig.login_title;
                    document.getElementById('footerText').textContent = config.footer_text || defaultConfig.footer_text;
                },
                mapToCapabilities: (config) => ({
                    recolorables: [],
                    borderables: [],
                    fontEditable: undefined,
                    fontSizeable: undefined
                }),
                mapToEditPanelValues: (config) => new Map([
                    ["site_title", config.site_title || defaultConfig.site_title],
                    ["login_title", config.login_title || defaultConfig.login_title],
                    ["footer_text", config.footer_text || defaultConfig.footer_text]
                ])
            });
        }

        // Login functionality
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (username === 'admin' && password === '@smaitputri2025') {
                document.getElementById('loginPage').classList.add('hidden');
                document.getElementById('mainApp').classList.remove('hidden');
                loadStudentData();
            } else {
                document.getElementById('loginError').classList.remove('hidden');
            }
        });

        // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', function() {
            document.getElementById('mainApp').classList.add('hidden');
            document.getElementById('loginPage').classList.remove('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
            document.getElementById('loginError').classList.add('hidden');
        });

        // Tab functionality
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const tabName = this.dataset.tab;
                switchTab(tabName);
            });
        });

        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('tab-active');
                btn.classList.add('hover:bg-gray-300');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('tab-active');
            document.querySelector(`[data-tab="${tabName}"]`).classList.remove('hover:bg-gray-300');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(`${tabName}Tab`).classList.remove('hidden');

            currentTab = tabName;

            if (tabName === 'infografis') {
                updateInfografis();
            }
        }

        // Load student data from CSV
        async function loadStudentData() {
            try {
                const response = await fetch(CSV_URL);
                const csvText = await response.text();
                studentsData = parseCSV(csvText);
                filteredData = [...studentsData];
                
                populateFilters();
                displayData();
                updateInfografis();
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('dataTableBody').innerHTML = `
                    <tr>
                        <td colspan="10" class="px-4 py-8 text-center text-red-500">
                            Gagal memuat data. Silakan coba lagi.
                        </td>
                    </tr>
                `;
            }
        }

        // Parse CSV data
        function parseCSV(csvText) {
            const lines = csvText.trim().split('\n');
            const headers = lines[0].split(',').map(h => h.trim().replace(/"/g, ''));
            const data = [];

            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(v => v.trim().replace(/"/g, ''));
                if (values.length >= headers.length) {
                    const row = {};
                    headers.forEach((header, index) => {
                        row[header] = values[index] || '';
                    });
                    data.push(row);
                }
            }

            return data;
        }

        // Populate filter dropdowns
        function populateFilters() {
            const kelasSet = new Set();
            studentsData.forEach(student => {
                if (student.kelas) {
                    kelasSet.add(student.kelas);
                }
            });

            const kelasOptions = Array.from(kelasSet).sort();
            const kelasFilter = document.getElementById('kelasFilter');
            const infografisKelasFilter = document.getElementById('infografisKelasFilter');
            
            [kelasFilter, infografisKelasFilter].forEach(select => {
                select.innerHTML = '<option value="">Semua Kelas</option>';
                kelasOptions.forEach(kelas => {
                    select.innerHTML += `<option value="${kelas}">${kelas}</option>`;
                });
            });
        }

        // Display data in table
        function displayData() {
            const tbody = document.getElementById('dataTableBody');
            const startIndex = (currentPage - 1) * entriesPerPage;
            const endIndex = entriesPerPage === 'all' ? filteredData.length : startIndex + parseInt(entriesPerPage);
            const pageData = entriesPerPage === 'all' ? filteredData : filteredData.slice(startIndex, endIndex);

            if (pageData.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="10" class="px-4 py-8 text-center text-gray-500">
                            Tidak ada data yang ditemukan
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = pageData.map((student, index) => `
                <tr class="border-b hover:bg-gray-50">
                    <td class="px-4 py-3">${student.NISN || '-'}</td>
                    <td class="px-4 py-3 font-medium">${student['Nama Lengkap'] || '-'}</td>
                    <td class="px-4 py-3">${student['Tempat Lahir'] || '-'}</td>
                    <td class="px-4 py-3">${student['Tanggal Lahir'] || '-'}</td>
                    <td class="px-4 py-3">${student['Jenis kelamin'] || '-'}</td>
                    <td class="px-4 py-3">
                        <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-sm font-medium">
                            ${student.kelas || '-'}
                        </span>
                    </td>
                    <td class="px-4 py-3">${student['Nomor Hp Siswa'] || '-'}</td>
                    <td class="px-4 py-3">${student['Nomor Hp Org Tua'] || '-'}</td>
                    <td class="px-4 py-3">
                        ${student['Pass Photo'] ? 
                            `<img src="${student['Pass Photo']}" alt="Foto ${student['Nama Lengkap']}" 
                                 class="thumbnail w-12 h-12 object-cover rounded-lg cursor-pointer shadow-sm border-2 border-gray-200" 
                                 onclick="showPhotoPopup('${student['Pass Photo']}', '${student['Nama Lengkap'] || 'Siswa'}')">` 
                            : '<span class="text-gray-400">Tidak ada foto</span>'
                        }
                    </td>
                    <td class="px-4 py-3">
                        <div class="flex space-x-2">
                            <button class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-lg text-sm transition duration-200">
                                ‚úèÔ∏è Edit
                            </button>
                            <button class="delete-btn bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded-lg text-sm transition duration-200" 
                                    onclick="deleteStudent(${startIndex + index})">
                                üóëÔ∏è
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');

            updatePagination();
        }

        // Update pagination
        function updatePagination() {
            const totalPages = entriesPerPage === 'all' ? 1 : Math.ceil(filteredData.length / entriesPerPage);
            const startEntry = entriesPerPage === 'all' ? 1 : (currentPage - 1) * entriesPerPage + 1;
            const endEntry = entriesPerPage === 'all' ? filteredData.length : Math.min(currentPage * entriesPerPage, filteredData.length);

            document.getElementById('showingStart').textContent = filteredData.length > 0 ? startEntry : 0;
            document.getElementById('showingEnd').textContent = endEntry;
            document.getElementById('totalEntries').textContent = filteredData.length;

            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';

            if (entriesPerPage !== 'all' && totalPages > 1) {
                // Previous button
                if (currentPage > 1) {
                    pagination.innerHTML += `
                        <button onclick="changePage(${currentPage - 1})" 
                                class="px-3 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition duration-200">
                            ‚Äπ Prev
                        </button>
                    `;
                }

                // Page numbers
                for (let i = Math.max(1, currentPage - 2); i <= Math.min(totalPages, currentPage + 2); i++) {
                    pagination.innerHTML += `
                        <button onclick="changePage(${i})" 
                                class="px-3 py-2 ${i === currentPage ? 'bg-blue-600 text-white' : 'bg-white border border-gray-300 hover:bg-gray-50'} rounded-lg transition duration-200">
                            ${i}
                        </button>
                    `;
                }

                // Next button
                if (currentPage < totalPages) {
                    pagination.innerHTML += `
                        <button onclick="changePage(${currentPage + 1})" 
                                class="px-3 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition duration-200">
                            Next ‚Ä∫
                        </button>
                    `;
                }
            }
        }

        // Change page
        function changePage(page) {
            currentPage = page;
            displayData();
        }

        // Filter and search functionality
        document.getElementById('kelasFilter').addEventListener('change', applyFilters);
        document.getElementById('searchInput').addEventListener('input', applyFilters);
        document.getElementById('entriesSelect').addEventListener('change', function() {
            entriesPerPage = this.value === 'all' ? 'all' : parseInt(this.value);
            currentPage = 1;
            displayData();
        });

        function applyFilters() {
            const kelasFilter = document.getElementById('kelasFilter').value;
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();

            filteredData = studentsData.filter(student => {
                const matchesKelas = !kelasFilter || student.kelas === kelasFilter;
                const matchesSearch = !searchTerm || 
                    (student['Nama Lengkap'] && student['Nama Lengkap'].toLowerCase().includes(searchTerm)) ||
                    (student.NISN && student.NISN.toLowerCase().includes(searchTerm));
                
                return matchesKelas && matchesSearch;
            });

            currentPage = 1;
            displayData();
        }

        // Reset filters
        document.getElementById('resetBtn').addEventListener('click', function() {
            document.getElementById('kelasFilter').value = '';
            document.getElementById('searchInput').value = '';
            document.getElementById('entriesSelect').value = '10';
            entriesPerPage = 10;
            currentPage = 1;
            filteredData = [...studentsData];
            displayData();
        });

        // Photo popup functionality
        function showPhotoPopup(photoUrl, studentName) {
            document.getElementById('popupImage').src = photoUrl;
            document.getElementById('popupName').textContent = studentName;
            document.getElementById('photoPopup').classList.remove('hidden');
        }

        document.getElementById('closePopup').addEventListener('click', function() {
            document.getElementById('photoPopup').classList.add('hidden');
        });

        document.getElementById('photoPopup').addEventListener('click', function(e) {
            if (e.target === this) {
                this.classList.add('hidden');
            }
        });

        // Delete student (placeholder function)
        function deleteStudent(index) {
            const studentName = filteredData[index]['Nama Lengkap'] || 'Siswa';
            
            // Create inline confirmation
            const row = document.querySelector(`#dataTableBody tr:nth-child(${(index % entriesPerPage) + 1})`);
            const deleteCell = row.querySelector('td:last-child');
            
            deleteCell.innerHTML = `
                <div class="flex space-x-2">
                    <button onclick="confirmDelete(${index})" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded-lg text-sm transition duration-200">
                        Konfirmasi Hapus
                    </button>
                    <button onclick="cancelDelete()" class="bg-gray-500 hover:bg-gray-600 text-white px-3 py-1 rounded-lg text-sm transition duration-200">
                        Batal
                    </button>
                </div>
            `;
        }

        function confirmDelete(index) {
            // In a real application, this would make an API call to delete the data
            // For now, we'll just remove it from the local array
            const globalIndex = studentsData.findIndex(student => student === filteredData[index]);
            if (globalIndex !== -1) {
                studentsData.splice(globalIndex, 1);
                applyFilters();
                updateInfografis();
            }
        }

        function cancelDelete() {
            displayData(); // Refresh the display to restore original buttons
        }

        // Update infografis
        function updateInfografis() {
            const kelasFilter = document.getElementById('infografisKelasFilter').value;
            let dataToAnalyze = kelasFilter ? 
                studentsData.filter(student => student.kelas === kelasFilter) : 
                studentsData;

            // Update stats
            document.getElementById('totalSiswa').textContent = dataToAnalyze.length;
            
            const lakiCount = dataToAnalyze.filter(student => 
                student['Jenis kelamin'] && student['Jenis kelamin'].toLowerCase().includes('laki')).length;
            const perempuanCount = dataToAnalyze.filter(student => 
                student['Jenis kelamin'] && student['Jenis kelamin'].toLowerCase().includes('perempuan')).length;
            
            document.getElementById('totalLaki').textContent = lakiCount;
            document.getElementById('totalPerempuan').textContent = perempuanCount;

            // Update class distribution
            const classDistribution = {};
            dataToAnalyze.forEach(student => {
                if (student.kelas) {
                    classDistribution[student.kelas] = (classDistribution[student.kelas] || 0) + 1;
                }
            });

            const distributionContainer = document.getElementById('classDistribution');
            const maxCount = Math.max(...Object.values(classDistribution));
            
            distributionContainer.innerHTML = Object.entries(classDistribution)
                .sort(([a], [b]) => a.localeCompare(b))
                .map(([kelas, count]) => {
                    const percentage = maxCount > 0 ? (count / maxCount) * 100 : 0;
                    return `
                        <div class="mb-4">
                            <div class="flex justify-between items-center mb-2">
                                <span class="font-medium text-gray-700">${kelas}</span>
                                <span class="text-sm text-gray-600">${count} siswa</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-3">
                                <div class="progress-bar h-3 rounded-full transition-all duration-500" 
                                     style="width: ${percentage}%"></div>
                            </div>
                        </div>
                    `;
                }).join('');
        }

        // Infografis filter
        document.getElementById('infografisKelasFilter').addEventListener('change', updateInfografis);
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99e3719a62b8ce19',t:'MTc2MzA5MTE2OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>